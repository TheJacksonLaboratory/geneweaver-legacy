{% set title=tool.name + " Results" %}
{% include 'header.html' %}
{% import 'macros.html' as macros %}

<div class="page-header">
    <h1>{{ title }}</h1>
</div>

<form id="todo-id" class="form-horizontal" role="form" method="post">
    <div class="row">
        <div class="col-md-4">
                <div class="panel panel-info">
				<div class="panel-heading">
					<h2 class="panel-title">
						<a data-toggle="collapse" data-parent="#accordion" href="#jcCollapse">
							Rerun Tool Options
						</a>
					</h2>
				</div>
				<div id="jcCollapse" class="panel-collapse collapse">
					<div class="panel-body">
						<div class="form-group">{{ macros.tool_param_radio(tool.params['JaccardSimilarity_Homology']) }}</div>
						<div class="form-group">{{ macros.tool_param_select(tool.params['JaccardSimilarity_PairwiseDeletion']) }}</div>

						<input type="hidden" name="genesets" value="{{async_result.gs_ids|join(' ') }}" />

						<button class="btn btn-primary" 
							type='submit'
							value='run'
							onclick='this.form.action="{{ url_for('JaccardSimilarity.run_tool') }}";'>
							Run
						</button>
					</div>
				</div>
			</div>
        </div>
    </div>
</form>

<br /><h4>Table view:</h4>

<br clear="all" /><div class="floatGeneList">
<form name="listform" id="listform">
<table cellspacing="0" style="font-size: 0.75em; "><tr><th valign="bottom" align="left" style=" border-bottom: thin solid #ccc;"> &nbsp;

{% for item in async_result.geneset_table %}
  </th><th style="border-top: 1px solid #000; border-left: 1px solid #000; border-bottom: thin solid #ccrc; {cycle values=",background-color: #fff;"}">
  <a href="{{ item.url }}">{{ item.gsID }}</a>
{% endfor %}
</th></tr>

{% for item in async_result.geneset_table %}
<tr><td style="border-bottom: none; white-space:nowrap;" align="left">
<input type="checkbox" name="gs_id[]" value="{{ item.gsID[:2] }}">
<a style="margin-left: 50px; font-size:1.5em;" href="{{ item.url }}">{{ item.text }} &nbsp;</a>
</td>

    {% for jac in item.entries %}
	<td align="center" style=" padding: 0.5em; border-left: thin solid #000; {{ jac.background }}">
    {% if jac.url == 0 %}
	   <a href="/geneset_intersection/4/5/6">{{ jac.text | safe }}</a>
    {% else %}
	   <span style="font-size: 0.75em;">{{ jac.text | safe }}</span>
    {% endif %}
    </td>
    </label>

	{% endfor %}
<td style="width: 25em;">&nbsp;</td></tr>
{% endfor %}

<tr><td colspan="4" style="border-bottom: none;">
<input style="margin-top: 2px" type="checkbox" value="all" onclick="ODE.select_all(this.checked, 'gs_id[]');">
    <p style="margin-left:30px; font-size: 15px;"> Select All
    <select name="addToProject" onchange="javascript:handleSelect(this);">
        <option value="-1">Add selected to project...</option>
        {% for project in list %}
            <option value="{{project.project_id}}">{{project.name}} {{project.project_id}} ({{project.count}})</option>
        {% endfor %}
        <option value="-2">+ Create new project...</option></select></p>
	<script type="text/javascript">
		function handleSelect(elm)
		{
			var genesets = []
			    $('input:checkbox[name="gs_id[]"]').each(function() {
				if (this.checked) {
				    genesets.push(this.value);
				}
			    });
			for(var i = 0; i < genesets.length; i++)
			{
				$.get("/add_geneset_to_project/"+elm.value+"/"+genesets[i]+".html",function(data,status){
  				});
			}
		}
	</script>
</td></tr>
</table>

<br /><br /><h4>Venn Diagram view:</h4>

View As:</br>
<form>
	<label>SVG<input type="radio" name="view" value="svg" onclick="changeImg(this, false);" checked></label>
	<label>PNG<input type="radio" name="view" value="png" onclick="changeImg(this, false);"></label>
</form>

Download As:
<select name="downloadType" id="downloadType">
	<option value="null">Select file type...</option>
	<option value="{{ url_for('static_results', filename=async_result.parameters.output_prefix + '.svg') }}">SVG</option>
	<option value="{{ url_for('static_results', filename=async_result.parameters.output_prefix + '.pdf') }}">PDF</option>
	<option value="{{ url_for('static_results', filename=async_result.parameters.output_prefix + '.png') }}">PNG</option>
</select>

<div class="row">
    <div class="col-md-12 link-panel" style="text-align: center;">
        <iframe style="width:90%; height:95%; min-height: 550px;" src="{{ url_for('static_results', filename=async_result.parameters.output_prefix + '.svg') }}" id="svgFrame" frameborder="0"></iframe>
    </div>
</div>

<a target="_blank" href="{{ url_for('static_results', filename=async_result.parameters.output_prefix + '.svg') }}">Open in New Window</a>

<script type="text/javascript">
	var urlMenu = document.getElementById("downloadType");
	urlMenu.onchange = function () {
		if(this.value!='null'){
			window.open(this.options[this.selectedIndex].value, '_blank');
		}
	}
	
function changeImg(sel, dl) {
	
	if(sel.value=='svg') {
		document.getElementById("svgFrame").src="{{ url_for('static_results', filename=async_result.parameters.output_prefix + '.svg') }}";
	}
	else if(sel.value=='png') {
		document.getElementById("svgFrame").src="{{ url_for('static_results', filename=async_result.parameters.output_prefix + '.png') }}";
	}
}

function genesetCheckboxChanged(projCheckbox, genesetCheckboxes) {
        var allChecked = true;
        genesetCheckboxes.each(function(i, gsCheckbox) {
            gsCheckbox = $(gsCheckbox);
            if(!gsCheckbox.prop('checked')) {
                allChecked = false;
                return false;
            }
        });

        projCheckbox.prop('checked', allChecked);
    }

</script>

{% include 'footer.html' %}