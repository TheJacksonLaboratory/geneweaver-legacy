{% set title=tool.name + " Results" %}
{% include 'header.html' %}
{% import 'macros.html' as macros %}
<script type="text/javascript" src="/static/js/downloadSvg.js" charset="utf-8"></script>
<style>

.tick{
    font-size: 13.5px
}
.key > * {
    margin: 5px;
    display: inline-block;
    vertical-align: middle;
}

#panel, #flip {
    padding: 5px;
    text-align: left;
}

#panel {
    display: none;
    background-color: #FFFFFF;
}

#flip {
 height: 50px;
}

#rerunPanel, #rerunFlip {
    padding: 5px;
    text-align: left;
}

#rerunPanel {
    height: 350px;
    text-align: left;
    display: none;
}

#rerunFlip {
   height: 50px;
   text-shadow: none;
}
#rerun{
 float:right;
    display:block;
    margin-right: 585px;
    clear:left;
 }

.left-cell {
  vertical-align: middle;
  width: 200px;
}

.right-cell {
  display: table-cell;
  vertical-align: middle;
  text-align: right;
  right: 0;
}

.middle-cell {
  display: table-cell;
  vertical-align: middle;
  text-align: left;
  padding-left: 320px;
}

.box-header {
  padding-bottom: 5px;
  display: table;
  width: 90%;
}

#addToProject, #exportData {
    float: left;
}

 .divider{
    margin: 5px;
}

#checkall{
    float: left;
}

.bar {
  fill: steelblue;
}

.bar:hover {
  fill: green;
}

.bar > text{
    stroke: grey;
}

.bar:hover > text{
    stroke: black;
}

body {
    font: 10px sans-serif;
}

.top-buffer { margin-top:20px; }

.axis path,
.axis line {
    fill: none;
    stroke: #000;
    shape-rendering: crispEdges;
}

.axis--x path {
  display: none;
}

.line {
    fill: none;
    stroke: steelblue;
    stroke-width: 1.5px;
}

 div.tooltip {
  position: absolute;
  text-align: center;
  width: 300px;
  height: 60px;
  padding: 2px;
  font: 10px sans-serif;
  background: ghostwhite;
  pointer-events: none;}

</style>

<style type="text/css">
    .geneBox {
        padding: 7px;
        display: inline-block;
        border: 1px solid #000;
        vertical-align: middle;
    }

    #clickableHomology {
        cursor: pointer;
    }

    #clickablePriority {
        cursor: pointer;
    }

    #clickableGeneSymbol {
        cursor: pointer;
    }

    .loader {
        /* IE 8 */
        -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=50)";
        /* IE 5-7 */
        filter: alpha(opacity=40);
        /* Netscape */
        -moz-opacity: 0.4;
        /* Safari 1.x */
        -khtml-opacity: 0.4;
        /* Good browsers */
        opacity: 0.4;
        position: fixed;
        left: 0px;
        top: 0px;
        width: 100%;
        height: 100%;
        z-index: 9999;
    }

</style>

<div class="page-header">
    <h1>{{ title }}
        {{ runhash }} </h1>
</div>

<script>
    var line=true;
    var graph=true;
    var smooth=true;
    var showHideBox=function(){
        graphBar(graph,line,smooth);
    };
</script>
<!--note to future developers: this was done as a group project in undergrad, where we are not taught website development
therefore everything here is a kludge. the intention of the table is to be the same type of checkboxes
as on the previous page, but to get it to work, things that experienced web developer would scoff at have been done.

the checkboxes are supposed to toggle which graphs show up
fix the code to be maintainable and consistent with the rest of the website code if you can-->
</table>
<table>
    <tbody><tr>
        <td>
            <div class="ui-checkbox">

<div class="ui-checkbox"><label for="lineGraphCheckbox" class="ui-btn ui-corner-all ui-checkbox-on ui-btn-inherit ui-btn-icon-left"></label>
    <input type="checkbox" onclick="line=this.checked; showHideBox()" id="lineGraphCheckbox" checked="true"></div>

            </div>
        </td>
        <td>
            <strong>Best Fit Line</strong>
        </td>
    </tr>
    <tr>
        <td>
            <div class="ui-checkbox">


<div class="ui-checkbox"><label for="barGraphCheckbox" class="ui-btn ui-corner-all ui-checkbox-on ui-btn-inherit ui-btn-icon-left"></label>
    <input type="checkbox" onclick="graph=this.checked; showHideBox()" id="barGraphCheckbox" checked="true"></div>
            </div>
        </td>
        <td>
            <strong>Histogram Boxes</strong>
        </td>
    </tr>
    <tr>
        <td>
            <div class="ui-checkbox">


<div class="ui-checkbox"><label for="smoothGraphCheckbox" class="ui-btn ui-corner-all ui-checkbox-on ui-btn-inherit ui-btn-icon-left"></label>
    <input type="checkbox" onclick="smooth=this.checked; showHideBox()"
    id="smoothGraphCheckbox" checked="true"></div>
            </div>
        </td>
        <td>
            <strong>Interpolate Best Fit Line</strong>
        </td>
    </tr>
</tbody></table>

<div id="graphDiv">
    <table><tr
                    onmouseout="$('#sizeGraphButton')[0].setAttribute('class','btn-group');
                    $('#barGraphButton')[0].setAttribute('class','btn-group');"
            ><td>
                <svg id="sizeCircle" width="300" height="500" ></svg>
            </td>
            <td style="padding-left:50px">
                <svg id="barGraph" width="660" height="500"></svg>
            </td></tr>
    
            <tr>
                <td style="text-align: center">
                    <div class="btn-group"
                        onmouseover="this.setAttribute('class','btn-group open');"
                        id="sizeGraphButton"
                    >
                        <button type="button" class="btn btn-primary 
                            dropdown-toggle" data-toggle="dropdown" 
                            aria-haspopup="true" aria-expanded="false"
                        >
                            Download as...
                            <span class="caret"></span>
                        </button>
                        <script>
                            var sizeGraph=$('#sizeCircle')[0];
                        </script>
                        <ul class="dropdown-menu"
                            onmouseout="$('#sizeGraphButton')[0].setAttribute('class','btn-group');"
                        >
                            <li onclick="download(sizeGraph,null,true);">
                                <a class="download-image" id="dl-png">PNG</a></li>
                            <li onclick="download(sizeGraph,null,false);">
                                <a class="download-image" id="dl-svg" >SVG</a>
                            </li>
                        </ul>
                    </div>
                </td>
                <td style="text-align: center">
                    <div style="padding-left:60px">
                    <div class="btn-group" 
                        onmouseover="this.setAttribute('class','btn-group open');"
                        id="barGraphButton"
                    >
                        <button type="button" class="btn btn-primary
                            dropdown-toggle" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false"
                        >
                            Download as...
                            <span class="caret"></span>
                        </button>
                        <script>
                            var barGraph=$('#barGraph')[0];
                        </script>
                        <ul class="dropdown-menu"
                            onmouseout="$('#barGraphButton')[0].setAttribute('class','btn-group');"
                        >
                            <li onclick="download(barGraph,null,true);">
                                <a class="download-image" id="dl-png2">PNG</a></li>
                            <li onclick="download(barGraph,null,false);">
                                <a class="download-image" id="dl-svg2" >SVG</a>
                            </li>
                        </ul>
                    </div>
                    </div>
                </td>
            </tr>
            <tr>
                <td colspan="2" style="padding-top: -20px">
                    <hr/>
                </td>
            </tr>
    </table>
</div>
<script src="/static/d3/d3.js" charset="utf-8"></script>
<script>
    var baseSize=1;
    var radius=baseSize*Math.pow(
        {{async_result.datafile['data'][0]['interestToBackgroundSizeRatio']}},
        .5
    );
    var baseFromCorner=1-radius;//baseSize/3;
    var circleGraph=d3.select("#sizeCircle")
        .style("display","block")
        .style("margin","auto")
        .attr("viewBox","-1 -1 2 2");

    circleGraph.append("circle")
        .attr("r",baseSize)
        .attr("fill","steelblue");

    circleGraph.append("circle")
        .attr("cy",baseFromCorner)
        .attr("r",radius)
        .attr("fill","blue")
        .attr("transform","rotate(30)");

    circleGraph.append("text")
        .style("font-size",".136px")
        .attr("dx","-7em")
        .attr("dy","-10.12em")
        .text("Size Comparison");

    var legend=circleGraph.append("g")
        .style("stroke-width",".01px");

    legend.append("rect")
	    .attr("x", "-1px")
	    .attr("y", "1.21px")
	    .attr("width", "1")
	    .attr("height", ".14")
        .style("fill","blue")
        .style("stroke-width","1px")
    legend.append("text")
	    .attr("dy", "13.1em")
	    .attr("dx", "-6.5em")
        .style("stroke","white")
            .style("stroke-width","0.001px")
            .style("fill","white")
        .style("font-size",".1px")
        .text("Interest");


    legend.append("rect")
	    .attr("y", "1.21px")
	    .attr("width", "1")
	    .attr("height", ".14")
        .style("fill","steelblue")
        .style("stroke-width","1px")
    legend.append("text")
	    .attr("dy", "13.1em")
	    .attr("dx", "2em")
        .style("stroke","white")
            .style("stroke-width","0.001px")
            .style("fill","white")
        .style("font-size",".1px")
        .text("Background");
</script>
<script>//frequency graph


var data = d3.range({{ async_result.datafile['data'][0]['densityPointCount']}}).map(function(i) {

    var value={intersectSize: i , frequency: {{ async_result.datafile['data'][0]['density'] }}[i] };

    console.log(value);
    return value;
});

var margin = {top: 100, right: 20, bottom: 70, left: 40},
    width = +d3.select("#barGraph").attr("width") - margin.left - margin.right,
    height = +d3.select("#barGraph").attr("height") - margin.top - margin.bottom;

var x = d3.scale.ordinal().rangeRoundBands([0, width], .05);

var y = d3.scale.linear().range([height, 0]);

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom")
    .ticks(10);

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left")
    .ticks(10,"%");


  x.domain(data.map(function(d) { return d.intersectSize; }));
  y.domain([0, d3.max(data, function(d) { return d.frequency; })]);

var svg=d3.select("#barGraph").attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

var graphBar=function(drawBars,drawLine,smooth){

    svg.selectAll("*").remove();
    svg.append("text")
        .attr("dy","-3em")
        .style("text-anchor","start")
        .style("alignment-baseline","middle")
        .style("font-size","20")
        .text("Frequency Graph");

  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis)
    .selectAll("text")
      .style("text-anchor", "end")
      .attr("dx", ".2em")
      .attr("dy", ".7em")

  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis)
    .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", ".71em")
      .style("text-anchor", "end")
      .text("frequency");

  if(drawBars){
      var bars=svg.selectAll(".bar")
          .data(data)
        .enter().append("g")
          .attr("class", "bar");

    bars.append("rect")
          .attr("x", function(d) { return x(d.intersectSize); })
          .attr("width", x.rangeBand())
          .attr("y", function(d) { return y(d.frequency); })
          .attr("height", function(d) { return height - y(d.frequency); });
    bars.append("text").text(function(d){return ""+d.frequency})
      .attr("x", function(d) { return x(d.intersectSize); })
      .attr("y", function(d) { return y(d.frequency); })
      .attr("dx", ".5em")
      .attr("dy", "-1em")

  }


  var line=d3.svg.line()
      .x(function(d){ return x(d.intersectSize)+(x.rangeBand()/2);})
      .y(function(d){ return y(d.frequency);})
  if(smooth){
    line.interpolate("basis")
  }
  if(drawLine){
    svg.append("g").append("path")
        .attr("d",line(data))
        .style("fill","none")
        .style("stroke","black")
        .style("stroke-width","4-px");
  }

};
graphBar(true,true,true);

</script>


<p style="font-size: 16px">p-value: {{ async_result.datafile['data'][0]['pValue'] }}<br/>
{{ async_result.datafile['data'][0]['numSamples'] }} simulated results of length {{ async_result.datafile['data'][0]['sampleLength'] }} generated from background<br/>
{{ async_result.datafile['data'][0]['intersectGreaterCount'] }} simulated results of length {{ async_result.datafile['data'][0]['sampleLength'] }} contained at least as many matches to database as the actual expression results.<br/>
{{ async_result.datafile['data'][0]['inTopAndIntersectCount'] }} matches to
database found in microarray results</p>

<div class="panel panel-default">
        <div class="panel-heading" style="border-bottom-width: thick; border-bottom-color: #006400;">
            <h3 class="panel-title">Gene in both Top Genes and Set of Interest </h3>
        </div>
        <div class="panel-body" style="padding-top:10px;">

            <div class="row">
                <div class="col-xs-12 col-md-9">
                    <div class="row">
                    </div>
                </div>
                <div class="col-xs-6 col-md-3" style="margin:0; padding:0;">
					<button type="button" class="btn btn-block btn-warning" id="addNewGeneset" style="margin-bottom: 10px;">
						<i class="fa fa-list-ul pull-left"></i> Add Genes to GeneSet
					</button>
                </div>
            </div>

        {% if ignore == 0 %}
            <div class="row" >
                <!-- TODO make the table sortable, show more gene details -->
                <table class="table table-hover">
                    <tbody>
                    <tr>
                        <th>Default</th>
                        <th>
                            <span class="dropdown">

								<span id="clickableGeneSymbol"
									  data-toggle="dropdown"
									  aria-haspopup="true"
									  aria-expanded="true">

									<span id="altSymbolHeader">
										Entrez
									</span>
									<i id="type-loading" class="fa fa-caret-down"></i>

								</span>

								{#
									TODO: Should be rewritten to dynamically
									load gene types from the DB
								#}
								<ul class="dropdown-menu"
									aria-labelledby="clickableGeneSymbol">
									<li class="gene-type" rel="0"><a tabindex="0" class="" style="">
										<span class="text">Gene Symbol</span>
									</a></li>
									<li class="gene-type" rel="1"><a tabindex="0" class="" style="">
										<span class="text">Entrez</span>
									</a></li>
									<li class="gene-type" rel="2" class="selected"><a tabindex="0" class="" style="">
										<span class="text">Ensembl Gene</span>
									</a></li>
									<li class="gene-type" rel="2" class="selected"><a tabindex="0" class="" style="">
										<span class="text">UniGene</span>
									</a></li>
									<li class="gene-type" rel="2" class="selected"><a tabindex="0" class="" style="">
										<span class="text">MGI</span>
									</a></li>
									<li class="gene-type" rel="2" class="selected"><a tabindex="0" class="" style="">
										<span class="text">FlyBase</span>
									</a></li>
									<li class="gene-type" rel="2" class="selected"><a tabindex="0" class="" style="">
										<span class="text">WormBase</span>
									</a></li>
									<li class="gene-type" rel="2" class="selected"><a tabindex="0" class="" style="">
										<span class="text">RGD</span>
									</a></li>
									<li class="gene-type" rel="2" class="selected"><a tabindex="0" class="" style="">
										<span class="text">ZFIN</span>
									</a></li>
								</ul>
							</span>
                        </th>
                        <th>
                            Homology
                            <span id="clickableHomology" tabindex="0" data-trigger="focus">
                                <i class="fa fa-info-circle"></i>
                            </span>
                        </th>
                        <th>Score</th>
                        <th>Priority
                            <span id="clickablePriority" data-trigger="focus" tabindex="0">
                                <i class="fa fa-info-circle"></i>
                            </span>
                        </th>
                        <th>LinkOuts</th>
                        <th>Emphasis</th>
                        <th>&nbsp;</th>
                    </tr>

                     {% for geneset_value in geneset.geneset_values %}
                            <tr class="gene-list-row">
                                <td id="defaultSymbol">
                                    <strong>
                                        <a href="/search/?searchbar={{ geneset_value.source_list[0] }}&pagination_page=1&searchGenes=yes">
                                            {{ geneset_value.source_list[0] }}
                                        </a>
                                    </strong>
                                </td>
                                <td id="altSymbol" class="gene-symbol" ode-gene-id="{{ geneset_value.ode_gene_id }}">
                                    {# If the alternate ID type the user selected doesn't match the one belonging
                                       to the geneset_value, it means no alternate type exists for that gene and a
                                       default was used instead. #}
                                    {% if geneset_value.gdb_id == alt_gdb_id %}
                                            <strong>
                                                {{ geneset_value.ode_ref }}
                                            </strong>
                                    {% else %}
                                        <strong>
                                            None
                                        </strong>
                                    {% endif %}
                                </td>
                                <td>
                                    {# Make boxes for homology blocks #}
                                    {# see application.py for the list of species and colors #}
                                    {% for i in range(1,12) %}
                                        {# skip elements that are empty #}
                                        {% if tt[(i-1)] != 'empty' %}
                                            <span data-placement="top" data-toggle="tooltip" data-rel="tooltip" data-original-title="{{ tt[(i-1)] }}"
                                                  title="{{ tt[(i-1)] }}">
                                            {% set exists = ['1'] %}
                                            {% for h in geneset_value.hom|sort %}
                                                {% if h == i %}
                                                    <div class="geneBox" style="background-color: {{ colors[(i-1)] }};"></div>
                                                    {% if exists.append('1') %}{% endif %}
                                                {% endif %}
                                            {% endfor %}
                                            {% if exists|length == 1 %}
                                                <div class="geneBox"></div>
                                            {% endif %}
                                            </span>
                                        {% endif %}
                                    {% endfor %}
                                </td>
                                <td class="gene-value">
                                    <strong>
                                        {{ '%0.4f' % geneset_value.value|float }}
                                    </strong>
                                </td>
                                <td>
                                    <div class="progress">
                                        <div class="progress-bar progress-bar-success progress-bar-striped"
                                             data-aria-valuetransitiongoal="{{ '%.0f' % geneset_value.gene_rank|float }}"
                                             aria-valuenow="{{ '%.0f' % geneset_value.gene_rank|float }}"
                                             style="width: {{ '%.0f' % geneset_value.gene_rank|float }}%;">
                                            {{ '%.0f' % geneset_value.gene_rank|float }}
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <!-- TODO Insert outside links here -->
                                    {% set gene=geneset_value.source_list[0] %}
                                    {% include 'linkouts.html' %}
                                </td>

                                <td nowrap>
                                    <input type="checkbox" name="g_id[]" id="{{ geneset_value.ode_gene_id }}"
                                           onchange="emphasize('{{ geneset_value.ode_gene_id }}');"
                                           class="switch" data-size="mini"
                                           style="padding: 0px; vertical-align: middle;">

                                </td>
                                <td>
                                    <div class="ui-checkbox" style="padding: 0; border: 0; margin: 0;">
                                        <label for="addGeneset{{ geneset_value.source_list[0] }}"
                                               style="margin: -6px; padding-right: 0;">
                                            <input type="checkbox" name="gsoptions[]"
                                                   id="addGeneset{{ geneset_value.source_list[0] }}"
                                                   value="{{ geneset_value.source_list[0] }}"/>
                                        </label>
                                    </div>
                                </td>
                            </tr>

                    {% endfor %}
                	</tbody>
            	</table>
        	</div>
            {% else %}

                            <div class="row">
                <!-- TODO make the table sortable, show more gene details -->
                <table class="table table-hover">
                    <tbody>
                    <tr>
                        <th>Default</th>
                        <th>LinkOuts</th>
                        <th>Emphasis</th>
                        <th>&nbsp;</th>
                    </tr>

                     {% for geneset_value in geneset %}
                            <tr class="gene-list-row">
                                <td id="defaultSymbol">
                                    <strong>
                                        <a href="/search/?searchbar={{ geneset_value[0] }}&pagination_page=1&searchGenes=yes">
                                            {{ geneset_value[0] }}
                                        </a>
                                    </strong>
                                </td>
                                <td class="gene-value">
                                    <strong>
                                        {{ '%0.4f' % 1|float }}
                                    </strong>
                                </td>
                                <td>
                                    <!-- TODO Insert outside links here -->
                                    {% set gene=geneset_value[0] %}
                                    {% include 'linkouts.html' %}
                                </td>
                                <td>
                                    <div class="ui-checkbox" style="padding: 0; border: 0; margin: 0;">
                                        <label for="addGeneset{{ geneset_value[0] }}"
                                               style="margin: -6px; padding-right: 0;">
                                            <input type="checkbox" name="gsoptions[]"
                                                   id="addGeneset{{ geneset_value[0] }}"
                                                   value="{{ geneset_value[0] }}"/>
                                        </label>
                                    </div>
                                </td>
                            </tr>

                    {% endfor %}
                	</tbody>
            	</table>
        	</div>

            {% endif %}
    	</div>
	</div>

<script src="/static/d3/d3.min.js" charset="utf-8"></script>

<form id="todo-id" class="form-horizontal" role="form" method="post">
    <div class="panel panel-info" >
        <div  style="border-radius:4px;">
				<div class="panel-title" style="width:100%;">
					Tool Options
				</div>
        </div>
            <div class="panel-body" style="font-size:13px;border-radius:5px; border:1px solid #006400">
                <div class="row">
                    <div class="col-md-4">
                        <label style="width:50%;">
                            MSET Top Genes:
                        </label>
                        <input type=text class="form-control" name='MSET_TopGenes' style="width:25%; " />
                    </div>
                    <div class="col-md-4">
                        <label style="width:50%;">
                            MSET Interest Genes:
                        </label>
                        <input type=text class="form-control" name='MSET_InterestGenes' style="width:25%; " />
                    </div>
                </div>
                <div class="row top-buffer">
                    <div class="col-md-4">
                        {{ macros.tool_param_select(tool.params['MSET_Background']) }}
                    </div>
                    <div class="col-md-4">
                        {{ macros.tool_param_select(tool.params['MSET_NumberofSamples']) }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        {{ macros.tool_param_checkbox_mset(tool.params['MSET_Species']) }}
                    </div>
                    <div class="col-md-4">
                        <label style="width:50%;">
                            Projects:
                        </label>
                        <div id="geneset-count" class="h5"></div>
                            <!-- TODO make the table sortable, show more gene details -->
                            <!--Tried to deal with users that had large project files by using a scroll for overflow, but it did not work-->
                            <table class="table table-hover" style="overflow-y:scroll; height: 20px" id="allGenesets" cellpadding="0" cellspacing="0">
                                <tbody>

                                {% for proj in g.user.projects %}
                                    <tr>
                                        {# checkbox #}
                                        <td width="18">
                                            <div class="ui-checkbox proj-checkbox">
                                                <label for="proj-{{ proj.project_id }}-allcheck">
                                                    <input type="checkbox" data-project="{{ proj.project_id }}"
                                                           data-project-name="{{ proj.name }}"
                                                           name="project_{{ proj.project_id }}"
                                                           id="proj-{{ proj.project_id }}-allcheck"/>
                                                </label>
                                            </div>
                                        </td>
                                        {# Project Name #}
                                        <td>
                                            <span data-prod="{{proj.project_id }}" class="toggler" style="cursor:pointer;">
                                                <strong>{{ proj.name }}</strong>
                                                {% if proj.star == 't' %}
                                                    <span class="closedstar"></span>
                                                {% endif %}
                                            </span>
                                        </td>

                                    </tr>

                                    <tr class="gsid{{ proj.project_id }}" id="genesets-{{ proj.project_id }}"
                                        style="display: none;">
                                        <td colspan="9">
                                            <table id="project-body-{{ proj.project_id }}"
                                                   class="table table-hover">
                                            </table>
                                        </td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <input type="hidden" name="genesets" value="{{ async_result.gs_ids|join(' ') }}"/>
                    </div>
                    <div class="col-md-8">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <button class="btn btn-primary"
                                type='submit'
                                value='run'
                                onclick='this.form.action="{{ url_for('MSET.run_tool') }}";'>
                            Re-Run Tool
                        </button>
                    </div>
                </div>
            </div>
    </div>
</form>


<script type="text/javascript">

    	$('#addNewGeneset').on('click', function () {

		var checkedArray = [];
		$("input:checkbox[name='gsoptions[]']:checked").each(function(){
			//console.log($(this));
			checkedArray.push($(this).val());
		});

		if(typeof checkedArray != "undefined" && checkedArray != null && checkedArray.length > 0) {

			{# Assign the needed async_results variables #}
			var numGS = 0;
			// Genesets with newlines cause js to shit the bed and get stuck
			// in an infinite loading loop. Any variable replaced by jinja
			// should be safe'd and trimmed.
			var getStr = 'Genes dervied from the MSET Enrichment Test';
			getStr += '?' + getStr;

			// add in all the checked boxes gene names
			checkedArray.forEach(function (entry) {

				getStr += "?";
				getStr += entry;
				getStr += "?";
				getStr += '1';

			});

			// Load the new page with the extra url bit
			setTimeout(function(){
                window.location = "/uploadgeneset/" + getStr;
			}, 1000);
		}
		else{
			window.alert("No genes selected.")
		}
	});

</script>

{% include 'modal/addGenesetsToProjects.html' %}


{% include 'modal/addGenesetsToProjectsAlert.html' %}

<!-- Includes the footer for the page -->
{% include 'footer.html' %}