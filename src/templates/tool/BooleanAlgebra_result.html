{% set title=tool.name + " Results" %}
{% include 'header.html' %}
{% import 'macros.html' as macros %}

<div class="page-header">
    <h1>{{ title }}</h1>
</div>
<h8>Gene count: {{async_result.num_genes}}</h8>
<br><br>

        <button onclick="add_to_geneset()" id="createGeneset" class="float-left submit-button" >Add to New GeneSet</button>
        <br><br>


<div class="panel panel-default">
<div class="panel-heading bg-blue">
	<h3 class="panel-title">Gene List</h3>
</div>
<div class="panel-body">

<table class="table table-hover">
<tbody>
<tr>
	<th>Gene Symbol</th>
	<th>LinkOuts</th>
	<th>In Gene sets</th>
</tr>

<tr>
<td>
    <input type="checkbox" value="all" onclick="ODE.select_all(this.checked, 'gs');"><p style="margin-left: 50px;"> Select All </p>
</td>
<td></td>
<td></td>
</tr>

<!-- change to have venn diagram d3
http://www.benfrederickson.com/venn-diagrams-with-d3.js/
-->

{% for gene in async_result.gene_names %}
<tr>
<td>
<input id="{{gene}}" type="checkbox" name="gs" value="{{ gene }}">
<a href="/search/?searchbar={{ gene }}&pagination_page=1&searchGenes=yes" style="margin-left: 50px;">{{ gene }}</a></button>
</td>
<td>
{% include 'linkouts.html' %}
</td>
<td>
{% for gsid in async_result.geneset_from[gene] %}
    {% for ags in async_result.genesets[gsid] %}
        {% for gs in ags %}
            {% include 'viewGenesetTitleOnly.html' %}
        {% endfor %}
    {% endfor %}
{% endfor %}
</td>
{% endfor %}
<td>

</td>
</tr>


</tbody>
</table>
</div>
</div>

<script type="text/javascript">
    function add_to_geneset() {
        var gene_names = {{async_result.gene_names|tojson}};
        var genes = [];

        for (i=0; i<gene_names.length; i++) {
            if (document.getElementById(gene_names[i]).checked) {
                genes.push(gene_names[i]);
            }
        }

        if (genes.length != 0) {

            var gene_list = genes.join('%0A');

            var url = "/batchuploadgeneset.html/" + gene_list;
            window.location = url;
        }
        else {
            // need to have at least one gene to add, is there a max?
            window.alert("Please select at least one gene to add!");
        }
    }
</script>

{% include 'footer.html' %}