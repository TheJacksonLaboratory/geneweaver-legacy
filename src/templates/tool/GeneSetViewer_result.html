{% set title=tool.name + " Results" %}
{% include 'header.html' %}
{% import 'macros.html' as macros %}
<head xmlns="http://www.w3.org/1999/html">
    <meta charset="utf-8">
</head>

<script type="text/javascript" src="../../static/d3/d3.min.js"></script>

<div class="page-header">
    <h1>{{ title }}</h1>
</div>

<div id="ui-container">
    <form id="todo-id" class="form-horizontal" role="form" method="post">
        <div>
            <div id="show-tool-options" 
                 style="color:#006400; cursor:pointer; font-weight:600; 
                        text-decoration:underline;">
                Tool Options
                <i id="tool-options-caret" class="fa fa-caret-left"></i>
            </div>
            <div id="tool-options" 
                 style="display:none; text-align:left; background-color:#efe;
                        border-radius:5px; padding:15px; width:100%">
                <div class="row">
                    <div class="col-md-4">
                        {{ macros.tool_param_radio(tool.params['GeneSetViewer_Homology']) }}
                    </div>
                    <div class="col-md-4">
                        {{ macros.tool_param_select(tool.params['GeneSetViewer_MinDegree']) }}
                    </div>
                    <div class="col-md-4">
                        {{ macros.tool_param_radio(tool.params['GeneSetViewer_SupressDisconnected']) }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <input type="hidden" name="genesets" 
                               value="{{ async_result.gs_ids|join(' ') }}"/>
                    </div>
                    <div class="col-md-8">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <button class="btn btn-primary"
                                type='submit'
                                value='run'
                                onclick='this.form.action="{{ url_for('GeneSetViewer.run_tool') }}";'>
                            Re-Run Tool
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<div class="row">
    <div class="col-md-12 link-panel" style="text-align: center;">
        <div align="center" id="viewer" 
			 style="width:50%; height:55%; min-height:550px; margin:0 auto;">
		</div>
{#
        <iframe style="width:90%; height:95%; min-height: 550px;"
                src="{{ url_for('static_results', filename=async_result.parameters.output_prefix  + '.svg') }}"
                frameborder="0"></iframe>
#}
        <br/>
        <a href="{{ url_for('static_results', filename=async_result.parameters.output_prefix  + '.pdf') }}">Export
            GeneSet Graph as a PDF</a>
        -
        <a target="_blank"
           href="{{ url_for('static_results', filename=async_result.parameters.output_prefix  + '.svg') }}">Open in new
            window</a>
    </div>
</div>

<script type="text/javascript">

var filePath = "{{ url_for('static_results', filename=async_result.parameters.output_prefix  + '.svg') }}";

/**
  * This is done because some browsers won't render an embedded SVG properly
  * and instead attempt to download the SVG. So we do this disgusting hack where
  * d3js reads in the SVG file and appends the content to the DOM.
  */
d3.xml(filePath).mimeType('image/svg+xml').get(function(error, xml) {

	if (error) 
		throw error;

   d3.select("#viewer")
   	.node()
	.appendChild(xml.documentElement);

});

$(function() {

    $('#show-tool-options').on('click', function() {

        $('#tool-options').slideToggle();

        var caret = $(this).find('.fa-caret-left');

        // Rotate the caret depending on whether the options bar is toggled
        if (caret.hasClass('fa-rotate-270'))
            caret.attr('class', 'fa fa-caret-left');
        else
            caret.attr('class', 'fa fa-caret-left fa-rotate-270');

    });
});

</script>
{% include 'footer.html' %}
