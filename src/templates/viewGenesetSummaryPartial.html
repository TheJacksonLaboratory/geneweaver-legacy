{# 	This page is injected into analyze.html--really it's included in
	singleProject.html, which is rendered by flask and then injected. Anyway,
	it seems like the beginning element on this page MUST be a row (<tr>), 
	otherwise jQuery will discard all rows and cells when this page is appended
	to a table in analyze.html.
#}

<tr class="genesetdetails" id="{{ gs.geneset_id }}">

    {% if proj is defined %}
        <td width="40px">
            <div class="ui-checkbox" style="padding: 0; border: 0;">
                <label for="geneset_{{ gs.geneset_id }}">
                    <input type="checkbox" name="geneset_{{ gs.geneset_id }}" data-project="{{ proj.project_id }}"
                           data-parentproject="{{ proj.project_id }}"
                           class="proj-{{ proj.project_id }}-check"
                           id="geneset_{{ gs.geneset_id }}"/>
                </label>
            </div>
            {#
            <input
                    data-parentproject="{{ proj.project_id }}"
                    type="checkbox"
                    name="geneset_{{ gs.geneset_id }}"
                    class="table-checkbox proj-{{ proj.project_id }}-check"
                    style="margin: 2px; padding: 0px 2px;">
            #}

        </td>
    {% endif %}


    <td>

        <!-- Label the tier - which is the curation id, Geneset.cur_id -->
        {% if gs.cur_id == 1 %}
            <span class="tier1">Tier I</span>
        {% endif %}
        {% if gs.cur_id == 2 %}
            <span class="tier2">Tier II</span>
        {% endif %}
        {% if gs.cur_id == 3 %}
            <span class="tier3">Tier III</span>
        {% endif %}
        {% if gs.cur_id == 4 %}
            <span class="tier4">Tier IV</span>
        {% endif %}
        {% if gs.cur_id == 5 %}
            <span class="tier5">Tier V</span>
        {% endif %}
    </td>

    <td>
        <!-- Label the species -->
        {% if gs.sp_id == 1 %}
            <span class="mouse">Mouse</span>
        {% endif %}
        {% if gs.sp_id == 2 %}
            <span class="human">Human</span>
        {% endif %}
        {% if gs.sp_id == 3 %}
            <span class="rat">Rat</span>
        {% endif %}
        {% if gs.sp_id == 4 %}
            <span class="zebrafish">Zebrafish</span>
        {% endif %}
        {% if gs.sp_id == 5 %}
            <span class="fly">Fly</span>
        {% endif %}
        {% if gs.sp_id == 6 %}
            <span class="monkey">Monkey</span>
        {% endif %}
    </td>

    <td>
        <!-- Show the geneset size -->
        <strong>{{ gs.count }}</strong>
    </td>

    <td>
        <!-- Label the attribution -->
        {% if gs.attribution == 2 %}
            <span class="ctd">CTD</span>
        {% endif %}
        {% if gs.attribution == 7 %}
            <span class="drg">DRG</span>
        {% endif %}
        {% if gs.attribution == 8 %}
            <span class="go">GO</span>
        {% endif %}
        {% if gs.attribution == 9 %}
            <span class="mp">MP</span>
        {% endif %}

    </td>




    <td width="50%">

        <a href="/viewgenesetdetails/{{ gs.geneset_id }}">GS{{ gs.geneset_id }}: {{ gs.name }} </a>
        <!-- need status for if not normal -->
        {% if gs.status != "normal" %}
            <span class="gs_status gs_{{ gs.status }}"
                  title="This GeneSet has been marked as {{ gs.status }}">{{ gs.status }}</span>

            <script>
                // This fixes the deprecated tags which weren't rendering properly
                // due to the gs_ids attached at the end.
                $('.gs_status').each(function (index) {

                    var dep = '{{gs.status}}';

                    if (dep.slice(0, 2) === 'de') {

                        $(this).attr('class', 'gs_deprecated');
                        $(this).attr('title', 'This geneset has been marked ' +
                        'as deprecated.');
                        $(this).html('Deprecated');
                    }
                });
            </script>
        {% endif %}
    </td>


    {% if g.user is defined %}
        {% if proj is defined %}
            <td>
                <span id="add-{{ gs.geneset_id }}-button" data-toggle="modal"
                      data-target="#addModal_{{ gs.geneset_id }}"
                      style="cursor: pointer; color: #808080; margin: 2px; padding: 0px 2px;">
                    <i class="fa fa-folder-o"></i>
                </span>

                {% include 'modal/addGenesetsToProjectsFromAnalysis.html' %}


            </td>
        {% endif %}
    {% endif %}

    {# only want to display this from the projects page. This is not the correct way...#}
    {% if request.endpoint == "render_project_genesets" %}

        {% if g.user is defined %}
            {% if proj is defined %}
                <td>
                    <span id="remove-geneset-{{ gs.geneset_id }}" data-toggle="modal"
                          data-target="#removeModal_{{ gs.geneset_id }}"
                          style="cursor: pointer; color: #808080; margin: 2px; padding: 0px 2px;">
                        <i class="fa fa-trash-o"></i>
                    </span>

                    {% include 'modal/removeGenesetFromProject.html' %}
                </td>
            {% endif %}
        {% endif %}

    {% endif %}

    <td>
        <!--
			<a id="genesetChevron" onclick="toggleDetails('genesetDetails_{{gs.geneset_id}}')">
				<span class="fa fa-chevron-down"></span>
			</a>
			-->
        {% if proj is defined %}

            <span class="rExpand" data-placement="top" data-toggle="tooltip"
							data-rel="tooltip" data-original-title="View More Information"
							title="More Information" style="margin: 2px; padding: 0px 2px;">
				<span id="onGenesetMinus_{{ gs.geneset_id }}" style="display: none; color: #808080;">
                    <i class="fa fa-minus"></i></span>
				<span id="offGenesetPlus_{{ gs.geneset_id }}" style="color: #808080;">
                    <i class="fa fa-plus"></i></span>
			</span>

        {% else %}

            <span class="rowExpand">
				<span id="onGenesetChevron_{{ gs.geneset_id }}" style="display: none; color: #808080;">
                    <i class="fa fa-minus"></i></span>
				<span id="offGenesetChevron_{{ gs.geneset_id }}" style="color: #808080;">
                    <i class="fa fa-plus"></i></span>
			</span>

        {% endif %}
    </td>


</tr>

<!-- ##################### Geneset metadata #################3-->
<tr id="genesetdetails_{{ gs.geneset_id }}" style="display: none;">
    <td colspan="100%">

        <table class="table table-hover table-striped" id="nestedTable">

            <tr>
                <th style="width: 25%;">Figure Label:</th>
                <td style="width: 75%;">{{ gs.abbreviation }}</td>
            </tr>

            <tr>
                <th>Description:</th>
                <td>{{ gs.description }}</td>
            </tr>

            <!-- TODO account for null authors, get Publication info -->
            <tr>
                <th>Authors:</th>
                <td><i>{% if gs.publication.authors is defined %} {{ gs.publication.authors }} {% else %}None{% endif %}</i></td>
            </tr>

        </table>
    </td>
</tr>
<!-- ###################### End ##########################-->





<!-- Script for hiding or displaying geneset details -->
<script type="text/javascript">function toggleDetails(id) {
    var element = document.getElementById(id);

    if (element.style.display == "none")
        element.style.display = "block";

    else if (element.style.display == "")
        element.style.display = "block";

    else
        element.style.display = "none";
}
</script>

<style type="text/css">

    .rowExpand, .rExpand {
        cursor: pointer;
    }

</style>

<!-- Script for adding geneset to selected projects-->
<script type="text/javascript">
    function addToSelected(geneset_id) {
        var selector = ".modal_checkbox_" + geneset_id;
        $(selector).each(function () {
            if (this.checked) {
                var route = "/add_geneset_to_project/" + this.name + "/" + geneset_id + ".html";
                $.get(route, function (data, status) {
                });
            }
        });
    }

    //pass remove modal values to function
    function removeSelected(geneset_id, proj_id) {
        $.ajax({
            type: "GET",
            url: "../removeGenesetFromProject",
            data: {"gs_id": geneset_id, "proj_id": proj_id},
            success: function (data) {
                location.reload();
                $(document).trigger("add-alerts", [
                            {
                                'message': "Project name added successfully.",
                                'priority': 'success'
                            }
                ]);
            }
        });
    }

    $(function () {
        $("[data-toggle='tooltip']").tooltip();
    });

    $(document).ready(function () {

        $(".rowExpand").on('click', function () {

            var childId = $(this).parents("tr").prop("id");
            var hidden = $("#genesetdetails_" + childId).is(":visible");
            $("#genesetdetails_" + childId).toggle();
            if (hidden) {
                $("#onGenesetChevron_" + childId).toggle();
                $("#offGenesetChevron_" + childId).toggle();
            }
            else {
                $("#offGenesetChevron_" + childId).toggle();
                $("#onGenesetChevron_" + childId).toggle();
            }
        });

        $(".rExpand").on('click', function (event) {

			// Because this page is injected into analyze.html, this script 
			// will get written to that page multiple times, resulting in
			// multiple click handlers. We must stop propagation of additional
			// events otherwise bad things happen.
			event.stopImmediatePropagation();

            var child = $(this).parents("tr").prop("id");

			$("#genesetdetails_" + child).toggle();
			$("#offGenesetPlus_" + child).toggle();
			$("#onGenesetMinus_" + child).toggle();
        });

    });

</script>
