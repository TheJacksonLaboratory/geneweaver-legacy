{% set title="My Genesets" %}
{% include 'header.html' %}
{% import 'macros.html' as macros %}

<style type="text/css">
td.details-control {
    background: url('/static/images/purpledot.png') no-repeat center center;
    cursor: pointer;
}
tr.shown td.details-control {
    background: url('/static/images/plus2.gif') no-repeat center center;
}
</style>


{% if user_id == 0 %}
    {% include 'permissionError.html' %}
{% else %}


    {% block body %}

        <div id="maindiv" xmlns="http://www.w3.org/1999/html">

            <script>
                function format(d) {
                    // `d` is the original data object for the row
                    return '<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">' +
                            '<tr>' +
                            '<td>'+ d.gs_id+'</td>' +
                            '<td>What\'s in a name anyway</td>' +
                            '</tr>' +
                            '<tr>' +
                            '<td>Extension number:</td>' +
                            '<td>no comment</td>' +
                            '</tr>' +
                            '<tr>' +
                            '<td>Extra info:</td>' +
                            '<td>And any further details here (images etc)...</td>' +
                            '</tr>' +
                            '</table>';
                }


                $(function () {
                    $("[data-toggle='tooltip']").tooltip();
                });
                var r = false;
                var editor;
                $(document).ready(function () {

                    var trindex = 0;
                    var dbtable = '{{table}}';
                    var user_id = '{{user_id}}';
                    var columns = {{columns | safe}};
                    var numCols = columns.length;
                    var headerCols = {{headerCols | safe}};
                    var table = $('#mygenesetsViewer').dataTable({
                        "dom": 'T<"clear">lfrtip',
                        "tableTools": {"sSwfPath": "/static/pixit/admin/assets/plugins/datatables/swf/copy_csv_xls_pdf.swf"},
                        "processing": true,
                        "serverSide": true,
                        "ajax": {
                            'url': "/../getServersideGenesetsdb",
                            'type': 'GET',
                            "data": {"table": dbtable, "user_id": user_id}
                        },
                        "columns": [
                            {
                                "className": 'details-control',
                                "orderable": false,
                                "data": null,
                                "defaultContent": ''
                            },
                            {"name": "sp_id"},
                            {"name": "gs_count"},
                            {"name": "gs_id"},
                            {"name": "gs_name"},
                            {
                                "orderable": false,
                                "data": null,
                                "defaultContent": ''
                            }
                        ],

                        //"columns": columns,
                        "aoColumnDefs": [

                            {
                                "aTargets": [1],
                                "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
                                    $(nTd).empty();
                                    switch (sData) {
                                        case 1:
                                            $(nTd).append('<span class="mouse">Mouse</span>');
                                            break;
                                        case 2:
                                            $(nTd).append('<span class="human">Human</span>');
                                            break;
                                        case 3:
                                            $(nTd).append('<span class="rat">Rat</span>');
                                            break;
                                        case 4:
                                            $(nTd).append('<span class="zebrafish">ZFish</span>');
                                            break;
                                        case 5:
                                            $(nTd).append('<span class="fly">Fly</span>');
                                            break;
                                        case 6:
                                            $(nTd).append('<span class="monkey">Monkey</span>');
                                            break;
                                    }
                                }
                            },

                            {
                                "aTargets": [2],
                                "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
                                    var gsSize = sData;
                                    $(nTd).empty();
                                    $(nTd).append('<strong>' + gsSize + '</strong>');
                                }
                            },

                            {
                                "aTargets": [3],
                                "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
                                    var gsID = sData;
                                    $(nTd).empty();
                                    $(nTd).append('<strong>GS' + gsID + '</span>');
                                }
                            },

                            {
                                "aTargets": [4],
                                "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
                                    $(nTd).empty();
                                    $(nTd).append('<p><a href=\"/viewgenesetdetails/' + oData[3] + '\">' + sData + '</a></p>');
                                }
                            },

                            {
                                "aTargets": [5],
                                "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {

                                    /* Delete Button */
                                    var b = $('<button class="btn btn-danger" data-placement="top" data-toggle="tooltip" \
                            		        data-rel="tooltip" data-original-title="Delete GeneSet" type="button" title="Delete this GeneSet"\
                                            style="margin: 2px; padding: 0px 2px;">\
                            		        <i class="fa fa-times"></i></button>');
                                    /* Edit Button */
                                    var c = $('<button class="btn btn-success" type="button" data-placement="top" \
										    data-toggle="tooltip" data-rel="tooltip" data-original-total="Edit" \
										    title="Edit Name" style="margin: 2px; padding: 0px 2px;"> \
										    <i class="fa fa-edit"></i></button>');


                                    b.tooltip();
                                    b.click(function () {
                                        var cellData = oData[5];

                                        $('#delModal').modal({
                                            keyboard: true
                                        });

                                        $('#confirmDelete').on('click', function (e) {
                                            $.ajax({
                                                type: "GET",
                                                url: "../deleteGeneset",
                                                data: {"runHash": cellData, "user_id": user_id},
                                                success: function (data) {
                                                    table.fnClearTable(0);
                                                    table.fnDraw();
                                                }
                                            });
                                        });
                                    });

                                    c.tooltip();
                                    c.click(function () {
                                        var cellData = oData[2];
                                        alert(cellData);
                                    });


                                    $(nTd).empty();
                                    $(nTd).append(b).append(c);
                                }

                            }
                        ]

                    });

                    //$("tr").click(function() {
                    $('#mygenesetsViewer tbody').on('click', 'td.details-control', function () {
                       //if ($(this).find("td:first").length > 0) {
                           trindex++;
                        var tr = $(this).closest('tr');
                        var row = table.aoOpenRows(tr);
                        alert(row);
                        if (tr.child.isShown){
                            alert('top');
                            tr.child.hide();
                            //tr.removeClass('shown');
                        }
                        else {
                            alert('here');
                            tr.child(format(row.data())).show();
                            //tr.addClass('shown');
                        }
                        //var row= '><td>bang</td></tr>';

                           //adding animation to row
                            //var newRow = $("<tr id=tr"+ trindex + row).animate({
                            //    height: "140px",
                            //    opacity: 0.25
                            //}, 500);
                            //$(this).after(newRow);

                    });


                    // Add event listener for opening and closing details
                    //$('#mygenesetsViewer tbody').on('click', 'td.details-control', function () {
                    //    alert('one');
                    //    var $tr = $(this).closest('tr');
                    //    alert($tr.html());
                    //    var row = table.row.add($tr);
                    //    alert(row);
                        //if (row.child.isShown()) {
                            // This row is already open - close it
                        //    row.child.hide();
                        //    tr.removeClass('shown');
                        //}
                        //else {
                    //        alert('not open');
                            // Open this row
                    //        row.child(format(row.data())).show();
                    //        tr.addClass('shown');
                        //}
                    //});

                });

            </script>

            <p>


            <div class="panel panel-default panel-heading bg-gray-light">
                <h3 class="panel-title"><strong>My GeneSets </strong></h3>
            </div>

            <div class="panel panel-default">
                <div class="row">
                    <div class="col-md-12 col-sm-12 col-xs-12 table-responsive table-red filter-right">

                        <table id="mygenesetsViewer"
                               class="table table-striped table-hover table-dynamic dataTable no-footer table-tools">

                            <thead>
                            <tr>
                                {% for col in headerCols %}
                                    <th style="text-align: left">{{ col.capitalize() }}</th>
                                {% endfor %}
                            </tr>
                            </thead>
                            <tfoot>
                            <tr>
                                {% for col in headerCols %}
                                    <th style="text-align: left">{{ col.capitalize() }}</th>
                                {% endfor %}
                            </tr>
                            </tfoot>
                        </table>

                    </div>
                </div>
            </div>

        </div>


        <div class="modal fade" id="delModal">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title" id="delLabel">Delete Result</h3>
                    </div>
                    <div class="modal-body">
                        <h4>Are you sure that you want to delete this GeneSet?
                            This will permanently remove this GeneSet and may produce concurrency issues in projects.</h4>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-warning" id="confirmDelete" data-dismiss="modal">Delete
                            Results
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="editModal">
            <div class="modal-dialog">
                <div class="modal-content">
                    <form id="editResultName" name="editResultName" method="post" action="#" class="form-horizontal"
                          novalidate="novalidate">
                        <div class="modal-header">
                            <h3 class="modal-title" id="editLabel">Edit Result Name</h3>
                        </div>
                        <div class="modal-body">
                            <div class="form-class">
                                <label for="resultName">New Result Name:</label>
                                <input class="form-control input-lg" name="resultName" id="resultName" type="text">
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-primary" data-dismiss="modal" id="editSubmit">Submit
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>



    {% endblock %}


{% endif %}




{% include 'footer.html' %}
