{% set title="Geneset Details" %}
{% include 'header.html' %}
{% import 'macros.html' as macros %}

<style type="text/css">
    .geneBox {
        padding: 7px;
        display: inline-block;
        border: 1px solid #000;
        vertical-align: middle;
    }
</style>

{% if geneset.geneset_id is not defined %}

    <div class="alert alert-danger fade in">
        <button type="button" class="close" data-dismiss="alert" aria-hidden="false">&times;</button>
        The GeneSet that you are looking for does not exist or you do not have permission to view its properties.
        <p>
            {% if user_id != 0 %}
                <p>You may also want to check your group permission settings.</p>
                <a href="/accountsettings.html">
                    <button type="button" class="btn btn-danger m-t-10 m-r-10" id="acount-redirect">Account Settings
                    </button>
                </a>
            {% else %}
                <a href="/login.html">
                    <button type="button" class="btn btn-danger m-t-10 m-r-10" id="login-redirect">Login</button>
                </a>
                <a href="/register.html">
                    <button type="button" class="btn btn-default m-t-10">Or Create a New Account</button>
                </a>
            {% endif %}
        </p>
    </div>

{% else %}

    <div class="row" id="result"></div>

    <div class="panel panel-default panel-heading bg-gray-light">
        <h2 class="panel-title"><strong>GeneSet Information</strong></h2>
    </div>




    <div class="panel panel-default">
    <div class="panel-heading" style="border-bottom-width: thick; border-bottom-color: #006400;">
        <h3 class="panel-title">
            {% if geneset.cur_id == 1 %}
                <span class="tier1" style="vertical-align: middle">Tier I</span>
            {% endif %}
            {% if geneset.cur_id == 2 %}
                <span class="tier2" style="vertical-align: middle">Tier II</span>
            {% endif %}
            {% if geneset.cur_id == 3 %}
                <span class="tier3" style="vertical-align: middle">Tier III</span>
            {% endif %}
            {% if geneset.cur_id == 4 %}
                <span class="tier4" style="vertical-align: middle">Tier IV</span>
            {% endif %}
            {% if geneset.cur_id == 5 %}
                <span class="tier5" style="vertical-align: middle">Tier V</span>
            {% endif %}
            GS{{ geneset.geneset_id }} - {{ geneset.name }}</h3>
    </div>

    <!-- View GeneSet MetaData -->
    {% include 'viewGenesetMeta.html' %}

    <!-- Show the Geneset List -->
    <div class="panel panel-default">
        <div class="panel-heading" style="border-bottom-width: thick; border-bottom-color: #006400;">
            <h3 class="panel-title">Gene List</h3>
        </div>
        <div class="panel-body">
            <div class="col-xs-6 col-md-3" style="padding-bottom: 10px;">
                <button type="button" class="btn btn-lg btn-block btn-warning" id="addToProject">
                    <i class="fa fa-folder-o pull-left"></i> Add to Project
                </button>
            </div>
            <!-- TODO make the table sortable, show more gene details -->
            <table class="table table-hover">
                <tbody>
                <tr>
                    <th>Symbol</th>
                    <th>Alt Gene</th>
                    <th>Homology</th>
                    <th>Value</th>
                    <th>Priority <i class="fa fa-info"></i></th>
                    <th>LinkOuts</th>
                    <th>Emphasis</th>
                    <th>&nbsp;</th>
                </tr>

                {% for geneset_value in geneset.geneset_values %}
                    <tr>
                        <td>
                            <strong>
                                <a href="/search/?searchbar={{ geneset_value.source_list[0] }}&pagination_page=1&searchGenes=yes">
                                    {{ geneset_value.source_list[0] }}
                                </a>
                            </strong>
                        </td>
                        <td>
                            Alt Gene
                        </td>
                        <td>
                            <div class="geneBox" style="background-color: #58D87E;"></div>
                            <div class="geneBox" style="background-color: #588C7E;"></div>
                            <div class="geneBox" style="background-color: #F2E394;"></div>
                            <div class="geneBox" style="background-color: #1F77B4;"></div>
                            <div class="geneBox" style="background-color: #F2AE72;"></div>
                            <div class="geneBox" style="background-color: #F2AF28;"></div>
                            <div class="geneBox" style="background-color: #D96459;"></div>
                            <div class="geneBox" style="background-color: #D93459;"></div>
                            <div class="geneBox" style="background-color: #8C4646;"></div>
                            <div class="geneBox"></div>
                        </td>
                        <td>
                            {{ geneset_value.value }}
                        </td>
                        <td>
                            <div class="progress">
                                <div class="progress-bar progress-bar-success" data-aria-valuetransitiongoal="75" aria-valuenow="75" style="width: 75%;">75%</div>
                            </div>
                        </td>
                        <td>
                            <!-- TODO Insert outside links here -->
                            {% set gene=geneset_value.source_list[0] %}
                            {% include 'linkouts.html' %}
                        </td>

                        <td nowrap>
                            <input type="checkbox" name="g_id[]" id="{{ geneset_value.ode_gene_id }}"
                                   onchange="emphasize('{{ geneset_value.ode_gene_id }}');"
                                   class="switch" data-size="mini"
                                   style="padding: 0px; vertical-align: middle;">

                        </td>
                        <td>
                            <div class="ui-checkbox" style="padding: 0; border: 0;">
                                <label for="addGeneset{{ geneset_value.source_list[0] }}">
                                    <input type="checkbox" name="gsoptions[]" id="addGeneset{{ geneset_value.source_list[0] }}"
                                           value="{{ geneset_value.source_list[0] }}" />
                                </label>
                            </div>
                        </td>
                    </tr>
                {% endfor %}

                </tbody>
            </table>
        </div>
    </div>

    {% for gene in emphgeneids %}
        <script>
            document.getElementById("{{gene}}").checked = true;
        </script>
    {% endfor %}

    <!-- <body onload="myFunction()"> -->

    <script type="text/javascript">
        $("[name='g_id[]']").bootstrapSwitch();

        function emphasize(id) {
            if (document.getElementById(id).checked) {
                $.get("/emphasize/" + id + ".html", function (data, status) {
                });
            }
            else {
                $.get("/deemphasize/" + id + ".html", function (data, status) {
                });
            }
        }

        $(document).ready(function () {
            var gs_id = {{ geneset.geneset_id }};
            $('#exportData').on('click', function (e) {
                window.open('../exportGeneList/' + gs_id);
            });

            $('#viewSimilarGenesets').on('click', function (e) {

                window.open('../viewSimilarGenesets/' + gs_id, "_self");
            });

        });
        //});


    </script>

{% endif %}

{% include 'footer.html' %}
